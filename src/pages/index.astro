---
import Header from "../components/Header.svelte";
import "../styles/global.css";
import Footer from "../components/Footer.svelte";

const response = await fetch("http://localhost:3000/api/slides");
const slides = await response.json();
---

<head>
  <meta charset="UTF-8" />
  <title>GameCarousel</title>
  <style>
    .bg-gradient {
      background: linear-gradient(180deg, #555555 0%, #111111 100%);
      min-height: 100vh;
    }
    .carousel {
      position: relative;
      width: 100%;
      height: auto;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      align-items: start;
      justify-content: center;
    }
    .carousel img {
      width: 100%;
      height: 100%;
      max-width: none;
    }

    .slide {
      position: relative;
      top: auto;
      display: none;
      width: 100%;
      height: auto;
      object-fit: contain;
    }
    .carousel video {
      width: auto;
      height: 100%;
    }
    a svg {
      font-size: 16px;
    }
    .slide.active {
      display: block;
    }
    .logo {
      position: absolute;
      max-width: 100%;
      height: auto;
      transform-origin: top left;
    }

    .logo.active {
      display: block;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      position: absolute;
      width: 100%;
      top: 0%;
      height: 100%;
    }
    .controls button {
      background: rgba(0, 0, 0, 0);
      color: white;
      padding: 10px 20px;
      font-size: 18px;
    }
    .indicators {
      position: absolute;
      bottom: 3vh;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.8vh;
    }
    .indicator {
      width: 3.5vh;
      height: 0.7vh;
      background: gray;
      transition: background 0.5s;
      border-radius: 0.1vh;
      opacity: 0.6;
    }
    .indicator.active {
      background: white;
      opacity: 1;
    }
    .Description {
      position: absolute;
      text-align: left;
      transform: translateY(-50%);
      color: white;
      font-size: 3vw;
      font-weight: 800;
      line-height: 1.2;
      display: block;
      z-index: 1;
      max-width: 80%;
      white-space: normal;
      transform-origin: top left;
    }

    .hidden {
      display: none;
    }
    .links {
      z-index: 2;
      position: absolute;
      bottom: 4.5vh;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 4vh;
      font-weight: 400;
      display: flex;
      align-items: center;
      gap: 1.5vh;
    }
    .links svg {
      width: 4vh;
      height: 4vh;
    }

    .video-toggle-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: none;
      color: white;
      font-size: 3rem;
      cursor: pointer;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .links,
    .links span {
      white-space: nowrap;
    }
    .links a {
      display: inline-flex;
      width: 4vh;
      height: 4vh;
      align-items: center;
      justify-content: center;
    }
    .links a svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    button svg {
      width: 2vh;
      height: 2vh;
    }
    .carousel video {
      width: 100%;
    }
    .video-toggle-button svg {
      width: 8vh;
      height: 8vh;
      display: block;
    }
  </style>
</head>
<body>
  <Header client:only />
  <div class="bg-gradient">
    <div class="carousel">
      {
        slides.map((item, index) => (
          <div
            class={`slide ${index === 0 ? "active" : ""}`}
            data-index={index}
            data-logo={item.featured_logo}
            data-logo-x={item.logo_x}
            data-logo-y={item.logo_y}
            data-logo-scale={item.logo_scale}
            data-text={item.featured_text}
            data-text-x={item.text_x}
            data-text-y={item.text_y}
            data-links-to-distribution-stores={JSON.stringify(
              item.links_to_distribution_stores
            )}
          >
            {item.featured_video ? (
              <video autoplay muted preload="metadata">
                <source src={item.featured_video} type="video/mp4" />
                <source src={item.featured_video} type="video/ogg" />
                Your browser does not support the video tag.
              </video>
            ) : (
              <>
                <img
                  src={`/image/image_1/${item.featured_image}`}
                  loading="lazy"
                  alt="Slide Image"
                />
                {item.featured_logo && (
                  <img
                    src={`/image/image_1/${item.featured_logo}`}
                    class="logo"
                    style={`top: ${item.logo_y * 100}%; left: ${item.logo_x * 100}%; transform: scale(${item.logo_scale})`}
                    alt="Featured Logo"
                  />
                )}
                {item.featured_text && (
                  <div
                    class="Description"
                    style={`top: ${item.text_y * 100}%; left: ${item.text_x * 100}%;`}
                  >
                    {item.featured_text}
                  </div>
                )}
              </>
            )}
          </div>
        ))
      }

      <aside class="links"></aside>

      <div class="controls">
        <button id="prevSlide">
          <svg
            viewBox="0 0 18 19"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M14.2466 1.05026C14.1152 0.981861 13.9721 0.94766 13.829 0.94766C13.649 0.94766 13.4708 1.00166 13.3169 1.10786L1.6169 9.20786C1.3739 9.37616 1.229 9.65246 1.229 9.94766C1.229 10.2429 1.3739 10.5192 1.6169 10.6875L13.3169 18.7875C13.5914 18.9774 13.9505 18.9999 14.2466 18.8451C14.5436 18.6894 14.729 18.3825 14.729 18.0477L14.729 1.84766C14.729 1.51286 14.5436 1.20596 14.2466 1.05026Z"
              fill="white"></path>
          </svg>
        </button>
        <button id="nextSlide">
          <svg
            viewBox="0 0 18 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M3.05393 17.897C3.18533 17.9654 3.32843 17.9996 3.47153 17.9996C3.65153 17.9996 3.82973 17.9456 3.98363 17.8394L15.6836 9.73941C15.9266 9.57111 16.0715 9.29481 16.0715 8.99961C16.0715 8.70441 15.9266 8.42811 15.6836 8.25981L3.98363 0.159806C3.70913 -0.0300944 3.35003 -0.0525944 3.05393 0.102206C2.75693 0.257906 2.57153 0.564806 2.57153 0.899606L2.57153 17.0996C2.57153 17.4344 2.75693 17.7413 3.05393 17.897Z"
              fill="white"></path>
          </svg>
        </button>
      </div>
      <button class="video-toggle-button" onclick="toggleVideo(event, this)">
        <svg
          width="8vh"
          height="8vh"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          ><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g
            id="SVGRepo_tracerCarrier"
            stroke-linecap="round"
            stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier">
            <path
              d="M9.5 9V15M14.5 9V15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
              stroke="#000000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </g></svg
        >
      </button>
      <div class="indicators">
        {
          slides.map((_, index) => (
            <div
              class={`indicator ${index === 0 ? "active" : ""}`}
              data-index={index}
            />
          ))
        }
      </div>
    </div>
  </div>
  <Footer />

  <script>
    // СРОЧНО заняться рефакторингом
    let currentSlide = 0;
    const slides = document.querySelectorAll(".slide");
    const totalSlides = slides.length;
    const videos = document.querySelectorAll("video");
    function decodeHTMLEntities(text) {
      const textarea = document.createElement("textarea");
      textarea.innerHTML = text;
      return textarea.value;
    }
    function toggleVideo(event, button) {
      // event.stopPropagation();
      const activeSlide = document.querySelector(".slide.active");
      // if (!activeSlide) return;
      const video = activeSlide.querySelector("video");
      // if (!video) return;

      if (video.paused) {
        video.play();
        button.innerHTML = `<svg width="8vh" height="8vh"  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M9.5 9V15M14.5 9V15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>`;
      } else {
        video.pause();
        button.innerHTML = `<svg width="8vh" height="8vh" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M15.0015 11.3344C15.3354 11.5569 15.5023 11.6682 15.5605 11.8085C15.6113 11.9311 15.6113 12.0689 15.5605 12.1915C15.5023 12.3318 15.3354 12.4431 15.0015 12.6656L11.2438 15.1708C10.8397 15.4402 10.6377 15.5749 10.4702 15.5649C10.3243 15.5561 10.1894 15.484 10.1012 15.3674C10 15.2336 10 14.9908 10 14.5052V9.49481C10 9.00923 10 8.76644 10.1012 8.63261C10.1894 8.51601 10.3243 8.44386 10.4702 8.43515C10.6377 8.42515 10.8397 8.55982 11.2438 8.82917L15.0015 11.3344Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>`;
        button.style.transform = "translateY(-50%) translateX(-50%)";
      }
    }

    let startIndex = 0;

    function updateLinks(slide) {
      const linksContainer = document.querySelector(".links");
      linksContainer.innerHTML = "<span>Buy it for</span>";
      const linksData = slide.getAttribute("data-links-to-distribution-stores");
      if (!linksData) return;
      const links = JSON.parse(linksData);
      const platforms = Object.keys(links);
      const visiblePlatforms = platforms.slice(startIndex, startIndex + 3);

      // Карта SVG по платформам
      const svgMap = {
        xbox: `<svg viewBox="0 0 48 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M24 1.88C19.9664 1.88 16.122 3.00911 12.933 4.98274C12.7273 5.05067 12.3712 5.32239 12.048 5.60879C14.9103 3.33407 21.5288 7.88903 23.4621 9.24579C23.787 9.47344 24.2148 9.47344 24.5398 9.24579C26.473 7.88903 33.0916 3.33407 35.9538 5.60879C35.6307 5.32239 35.2745 5.05067 35.0689 4.98274C31.8798 3.00911 28.0336 1.88 24 1.88ZM10.84 7.52001C9.3382 7.52001 8.24215 8.74274 8.24215 8.74274C4.67676 12.5964 2.42773 17.7664 2.42773 23.5C2.42773 35.4373 12.0884 45.12 24 45.12C30.2844 45.12 36.0052 42.3936 39.9451 38.07C39.9451 38.07 39.477 35.25 36.5688 31.1136C33.3174 26.2099 26.73 20.0338 24.6224 18.1372C24.2625 17.8141 23.7264 17.8159 23.3684 18.1427C21.7804 19.5968 17.6807 23.6671 16.7774 24.7227C14.6202 26.9791 8.61668 34.1209 8.24215 38.1636C8.24215 38.1636 6.92762 34.9691 9.83574 27.6364C11.646 23.232 17.2658 16.6832 19.9903 13.8265C20.352 13.4482 20.3428 12.8497 19.9609 12.4899C19.0577 11.6454 16.9555 10.1638 15.059 9.02364C13.7463 8.17727 12.2463 7.61364 10.84 7.52001ZM36.8681 7.52001C36.2549 7.52001 32.2672 8.78313 28.0703 12.5009C27.6737 12.8516 27.6572 13.4666 28.0262 13.8466C29.5464 15.4182 33.7029 19.4407 36.1943 23.4064C39.2897 28.4827 41.1642 32.5236 40.0388 38.07C43.5087 34.2164 45.6677 29.14 45.6677 23.5C45.5741 17.86 43.4169 12.69 39.8515 8.83637C39.7579 8.74274 39.6642 8.64727 39.5706 8.55364C38.8197 7.70727 37.7126 7.52001 36.8681 7.52001Z" fill="white"/>
</svg>`,
        windows: `<svg viewBox="0 0 47 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.75977 3.76001H22.5598V22.56H3.75977V3.76001ZM24.4398 3.76001H43.2398V22.56H24.4398V3.76001ZM3.75977 24.44H22.5598V43.24H3.75977V24.44ZM24.4398 24.44H43.2398V43.24H24.4398V24.44Z" fill="white"/>
</svg>`,
        playstation: ` <svg viewBox="0 0 47 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1133_239)">
<path d="M18.1537 3.76001C17.871 3.76001 17.5846 3.74899 17.3019 3.93626C17.0191 4.12353 16.92 4.41728 16.92 4.70001V39.0981C16.92 39.4727 17.1917 39.8509 17.5662 40.0381L25.0863 42.3H25.38C25.5673 42.3 25.7509 42.2192 25.9381 42.1238C26.2209 41.9365 26.32 41.6427 26.32 41.36V12.6019C26.8855 12.8846 27.26 13.4427 27.26 14.1V24.5281C27.26 24.8109 27.4473 25.1964 27.73 25.2919C27.9173 25.3874 29.3273 26.2319 31.96 26.2319C34.4973 26.2319 37.6 24.8292 37.6 18.1538C37.6 12.7965 34.6037 8.7354 29.4338 7.13813L18.1537 3.76001ZM15.98 24.8219L5.55188 28.5819L4.05375 29.14C1.51648 30.1755 0 31.8535 0 33.5463C0 37.119 2.53727 39.1863 7.05 39.1863C9.49547 39.1863 12.5027 38.6465 15.98 37.4238V33.84C15.1355 34.1227 14.2065 34.4973 13.4537 34.78C11.9483 35.3455 10.81 35.5438 9.87 35.5438C8.46 35.5438 7.80273 35.0627 7.52 34.78C7.14547 34.4973 6.95453 34.1338 7.05 33.6638C7.14547 32.7238 8.27273 31.8609 10.34 31.1081C10.81 30.9209 14.0045 29.7973 15.98 29.14V24.8219ZM34.31 27.1719C32.0555 27.2674 29.7055 27.6309 27.26 28.2881V32.6063C28.2955 32.2317 29.6908 31.7727 31.6663 31.02C36.179 29.4227 38.0627 29.599 38.6281 29.7863C39.7554 29.8817 40.2327 30.55 40.42 31.02C40.89 32.43 39.1165 33.0763 36.4837 34.0163C35.261 34.4863 29.9845 36.3663 27.26 37.3063V41.6538L41.83 36.4838L42.9463 36.0138C44.8262 35.3565 47.1873 34.1227 47 31.96C46.9045 29.8927 44.3783 28.8536 42.5938 28.2881C39.961 27.4436 37.13 27.0764 34.31 27.1719Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_1133_239">
<rect width="47" height="47" fill="white"/>
</clipPath>
</defs>
</svg>`,
        macos: `<svg viewBox="0 0 48 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1133_450)">
<path d="M1 5V41.8404H48V5H1ZM27.1929 7.04791H45.9521V39.7925H28.5548C28.2788 38.8206 28.0748 37.8286 27.9309 36.8346C27.8189 36.0467 27.7549 35.2787 27.7149 34.5407V34.5307C27.7229 34.5287 27.7289 34.5267 27.7369 34.5247C27.7389 34.5907 27.7349 34.6487 27.7369 34.7147C28.4128 34.6747 29.0868 34.6227 29.7628 34.5407C33.3666 34.1208 36.9205 33.1668 40.2483 31.7029L39.4304 29.8309C36.3685 31.1729 33.1026 32.0608 29.7848 32.4708C29.1088 32.5528 28.4228 32.6268 27.7369 32.6668C27.7369 32.6868 27.7369 32.7108 27.7369 32.7308C27.7329 32.7308 27.7289 32.7288 27.7249 32.7288C27.7249 32.7208 27.7249 32.7148 27.7249 32.7068C27.7249 32.6868 27.7269 32.6768 27.7369 32.6668C27.7269 32.5948 27.7369 32.5328 27.7369 32.4708C27.8289 30.7409 28.1148 29.205 28.4528 27.895C28.5048 27.701 28.5548 27.515 28.6068 27.341C28.6168 27.331 28.6168 27.3111 28.6268 27.2911C28.7608 26.8191 28.9128 26.3791 29.0568 25.9691L29.5588 24.5972H20.6092C21.2031 20.4813 22.3811 16.4875 24.101 12.6997C24.991 10.7438 26.0149 8.84984 27.1929 7.04791ZM11.0456 12.1797H13.1315C13.1335 13.9056 13.1335 15.6315 13.1355 17.3595C12.4355 17.3535 11.7335 17.3495 11.0336 17.3435C11.0376 15.6215 11.0416 13.9016 11.0456 12.1797ZM33.6746 12.2177V17.3075H35.5845V12.2177H33.6746ZM9.46364 29.7689C13.5715 31.5809 17.9233 32.5728 22.3891 32.7168C23.477 32.7468 24.567 32.7388 25.655 32.6668C25.625 33.3228 25.625 34.0088 25.655 34.7147C24.925 34.7667 24.185 34.7867 23.457 34.7867C23.0771 34.7867 22.7091 34.7747 22.3291 34.7647C17.5973 34.6107 12.9855 33.5688 8.63168 31.6429L9.46364 29.7689Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_1133_450">
<rect width="47" height="47" fill="white" transform="translate(0.5)"/>
</clipPath>
</defs>
</svg>`,
        "nintendo switch": `<svg viewBox="0 0 47 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1216_746)">
<path d="M11.7828 0C7.76995 0 4.70568 1.17806 2.74735 3.47298C0.789016 5.7679 0 8.99828 0 12.8975V35.2784C0 42.0299 4.92862 47 11.7828 47H22.381V0H11.7828ZM35.2216 0L24.5906 0.0174851V47H35.2216C42.0911 47 47 42.0364 47 35.25V12.9259C47 4.43029 43.0221 0 35.2216 0ZM11.7828 2.2381H20.1429V44.7619H11.7828C5.95805 44.7619 2.2381 40.9939 2.2381 35.2784V12.8975C2.2381 9.30208 2.97903 6.64872 4.44996 4.92643C5.9209 3.20415 8.18959 2.2381 11.7828 2.2381ZM11.75 6.71429C10.1654 6.71429 8.83436 7.34812 7.9754 8.31417C7.11644 9.28023 6.71429 10.5217 6.71429 11.75C6.71429 12.9783 7.11644 14.2198 7.9754 15.1858C8.83436 16.1519 10.1654 16.7857 11.75 16.7857C13.3346 16.7857 14.6656 16.1519 15.5246 15.1858C16.3836 14.2198 16.7857 12.9783 16.7857 11.75C16.7857 10.5217 16.3836 9.28023 15.5246 8.31417C14.6656 7.34812 13.3346 6.71429 11.75 6.71429ZM11.75 8.95238C12.7751 8.95238 13.4023 9.29771 13.8504 9.80041C14.2985 10.3031 14.5476 11.02 14.5476 11.75C14.5476 12.48 14.2985 13.1969 13.8504 13.6996C13.4023 14.2023 12.7751 14.5476 11.75 14.5476C10.7249 14.5476 10.0977 14.2023 9.6496 13.6996C9.20154 13.1969 8.95238 12.48 8.95238 11.75C8.95238 11.02 9.20154 10.3031 9.6496 9.80041C10.0977 9.29771 10.7249 8.95238 11.75 8.95238ZM35.8095 22.381C38.2771 22.381 40.2857 24.3896 40.2857 26.8571C40.2857 29.3247 38.2771 31.3333 35.8095 31.3333C33.3419 31.3333 31.3333 29.3247 31.3333 26.8571C31.3333 24.3896 33.3419 22.381 35.8095 22.381Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_1216_746">
<rect width="47" height="47" fill="white"/>
</clipPath>
</defs>
</svg>`,
        android: ` <svg
viewBox="0 0 41 47"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<g clip-path="url(#clip0_1216_2067)">
<path
  d="M8.13579 15.4678H32.4409V35.724C32.4409 36.9273 31.487 37.903 30.3118 37.903H27.8773V44.072C27.8773 45.6386 26.6555 46.9082 25.1473 46.9082C23.6353 46.9082 22.4153 45.6386 22.4153 44.072V37.903H18.1634V44.072C18.1634 45.6386 16.9392 46.9082 15.4311 46.9082C13.9233 46.9082 12.6992 45.6386 12.6992 44.072V37.903H10.2669C9.09143 37.903 8.1357 36.9273 8.1357 35.724L8.13579 15.4678ZM3.37284 15.3025C1.8493 15.3025 0.615234 16.5842 0.615234 18.1665V29.36C0.615234 30.9404 1.8493 32.2244 3.37284 32.2244C4.89664 32.2244 6.13044 30.9404 6.13044 29.36V18.1665C6.13044 16.5842 4.89664 15.3025 3.37284 15.3025ZM32.441 13.4266H8.13579C8.43576 9.88527 10.6819 6.8378 13.9154 5.07328L11.6045 1.60299C11.2929 1.13501 11.4105 0.496472 11.869 0.177845C12.3269 -0.140782 12.95 -0.01961 13.2632 0.448003L15.7818 4.23297C17.1783 3.7391 18.6941 3.45554 20.2883 3.45554C21.8845 3.45554 23.4004 3.7391 24.7967 4.23361L27.3154 0.44938C27.6247 -0.0195182 28.2498 -0.14069 28.7077 0.177937C29.1662 0.496564 29.2838 1.1351 28.9721 1.60308L26.6631 5.07337C29.8966 6.83679 32.1412 9.88426 32.441 13.4266ZM16.5064 8.61471C16.5064 7.85528 15.9052 7.23932 15.1629 7.23932C14.4187 7.23932 13.8174 7.85528 13.8174 8.61471C13.8174 9.37378 14.4207 9.98946 15.1629 9.98946C15.9051 9.98946 16.5064 9.37378 16.5064 8.61471ZM26.9296 8.61471C26.9296 7.85528 26.3263 7.23932 25.5842 7.23932C24.84 7.23932 24.2405 7.85528 24.2405 8.61471C24.2405 9.37378 24.84 9.98946 25.5842 9.98946C26.3264 9.98946 26.9296 9.37378 26.9296 8.61471ZM37.2057 15.2985C35.6838 15.2985 34.4462 16.5822 34.4462 18.1646V29.362C34.4462 30.9444 35.6838 32.2285 37.2057 32.2285C38.7296 32.2285 39.9614 30.9445 39.9614 29.362V18.1646C39.9614 16.5822 38.7296 15.2985 37.2057 15.2985Z"
  fill="white"
/>
</g>
<defs>
<clipPath id="clip0_1216_2067">
  <rect
    width="39.7692"
    height="47"
    fill="white"
    transform="translate(0.615234)"
  />
</clipPath>
</defs>
</svg>`,
        ios: `<svg viewBox="0 0 48 47" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M42.3557 32.6649C41.3422 34.9158 40.8539 35.9219 39.5503 37.9084C37.7254 40.6843 35.1514 44.1506 31.9716 44.1726C29.1406 44.1983 28.4099 42.3256 24.5654 42.3587C20.7246 42.3771 19.9242 44.2093 17.0895 44.1799C13.906 44.1506 11.4715 41.0295 9.64659 38.2572C4.54268 30.4838 4.00292 21.3703 7.15706 16.5234C9.38956 13.0865 12.9182 11.067 16.2339 11.067C19.6121 11.067 21.7344 12.9213 24.525 12.9213C27.2349 12.9213 28.8835 11.0633 32.7904 11.0633C35.7426 11.0633 38.8637 12.6716 41.0962 15.4475C33.7965 19.4499 34.9825 29.8743 42.3557 32.6649ZM29.8235 7.96057C31.2446 6.13564 32.3241 3.56166 31.9312 0.939941C29.6142 1.09783 26.9044 2.5776 25.3218 4.49432C23.8861 6.24213 22.6964 8.83447 23.1591 11.3424C25.689 11.4231 28.3071 9.914 29.8235 7.96057Z" fill="white"/>
</svg>`,
        linux: `<svg width="40" height="47" viewBox="0 0 40 47" fill="none" xmlns="http://www.w3.org/2000/svg">…</svg>`,
      };

      visiblePlatforms.forEach((platform, i) => {
        const url = links[platform];
        const linkEl = document.createElement("a");
        linkEl.style.width = "4vh";
        linkEl.style.height = "4vh";

        linkEl.href = url;
        linkEl.dataset.globalIndex = startIndex + i;
        linkEl.innerHTML = svgMap[platform] || platform;
        linkEl.addEventListener("click", (e) => {
          const idx = Number(linkEl.dataset.globalIndex);
          if (
            platforms.length > 3 &&
            idx >= startIndex + 2 &&
            idx < platforms.length - 1
          ) {
            e.preventDefault();
            startIndex = Math.min(idx, platforms.length - 3);
            updateLinks(slide);
          }
        });
        linksContainer.appendChild(linkEl);
      });

      // Кнопка «в начало», когда уже сдвиг
      if (platforms.length > 3 && startIndex > 0) {
        const resetLink = document.createElement("a");
        resetLink.href = "#";
        resetLink.classList.add("reset-link");
        resetLink.innerHTML = `
        <svg class="reset-icon" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3.05393 17.897C3.18533 17.9654 3.32843 17.9996 3.47153 17.9996C3.65153 17.9996 3.82973 17.9456 3.98363 17.8394L15.6836 9.73941C15.9266 9.57111 16.0715 9.29481 16.0715 8.99961C16.0715 8.70441 15.9266 8.42811 15.6836 8.25981L3.98363 0.159806C3.70913 -0.0300944 3.35003 -0.0525944 3.05393 0.102206C2.75693 0.257906 2.57153 0.564806 2.57153 0.899606L2.57153 17.0996C2.57153 17.4344 2.75693 17.7413 3.05393 17.897Z" fill="white"/>
</svg>

    `;
        resetLink.addEventListener("click", (e) => {
          e.preventDefault();
          startIndex = 0;
          updateLinks(slide);
        });
        linksContainer.appendChild(resetLink);
        const svg = resetLink.querySelector("svg");
        if (svg) {
          svg.removeAttribute("width");
          svg.removeAttribute("height");
          svg.style.width = "4vh";
          svg.style.height = "4vh";
        }
      }
    }

    function showSlide(index) {
      startIndex = 0;

      // Остановка видео, но на паузу не ставится!!!!
      videos.forEach((video) => {
        video.pause();
        video.currentTime = 0;
      });

      slides.forEach((slide, i) => {
        slide.classList.toggle("active", i === index);
      });

      // Обновляем индикаторы
      document.querySelectorAll(".indicator").forEach((el, i) => {
        el.classList.toggle("active", i === index);
      });

      const currentSlideElement = slides[index];

      // Обновляем описание
      const descriptionElement =
        currentSlideElement.querySelector(".Description");
      if (descriptionElement) {
        const rawText = currentSlideElement.getAttribute("data-text") || "";
        descriptionElement.innerHTML = decodeHTMLEntities(rawText);
        const textY =
          parseFloat(currentSlideElement.getAttribute("data-text-y")) || 0;
        const textX =
          parseFloat(currentSlideElement.getAttribute("data-text-x")) || 0;
        descriptionElement.style.top = textY * 100 + "%";
        descriptionElement.style.left = textX * 100 + "%";
      }

      // Обновляем лого
      const logoElement = document.querySelector(".logo");
      if (logoElement) {
        const logoY =
          parseFloat(currentSlideElement.getAttribute("data-logo-y")) || 0;
        const logoX =
          parseFloat(currentSlideElement.getAttribute("data-logo-x")) || 0;
        const logoScale =
          parseFloat(currentSlideElement.getAttribute("data-logo-scale")) || 1;
        logoElement.src =
          "/image/image_1/" + currentSlideElement.getAttribute("data-logo");
        logoElement.style.top = logoY * 100 + "%";
        logoElement.style.left = logoX * 100 + "%";
        logoElement.style.transform = "scale(" + logoScale + ")";
      }

      const video = currentSlideElement.querySelector("video");
      const linksContainer = document.querySelector(".links");
      const toggleButton = document.querySelector(".video-toggle-button");

      if (video) {
        linksContainer.style.display = "none";
        video.play();
        toggleButton.style.display = "block";
      } else {
        linksContainer.style.display = "flex";
        updateLinks(currentSlideElement);
        toggleButton.style.display = "none";
      }

      updateLinks(currentSlideElement);
      currentSlide = index;
    }

    document.getElementById("prevSlide").onclick = function () {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      showSlide(currentSlide);
    };

    document.getElementById("nextSlide").onclick = function () {
      currentSlide = (currentSlide + 1) % totalSlides;
      showSlide(currentSlide);
    };

    document.querySelectorAll(".indicator").forEach(function (block) {
      block.addEventListener("click", function () {
        let index = this.getAttribute("data-index");
        showSlide(Number(index));
      });
    });
    window.toggleVideo = toggleVideo;
    showSlide(0); // дляпервого лого нужно
  </script>
</body>
