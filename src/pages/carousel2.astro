---
import Header from "../components/Header.svelte";
import "../styles/global.css";
import Footer from "../components/Footer.svelte";

const response = await fetch("http://localhost:3000/api/slides");
const slides = await response.json();
---

<head>
  <meta charset="UTF-8" />
  <title>GameCarousel</title>
  <style>
    /* ПОЧИСТИТЬ СТИЛИ */
    .bg-gradient {
      background: linear-gradient(180deg, #555555 0%, #111111 100%);
      min-height: 100vh;
    }
    .carousel {
      position: relative;
      width: 100%;
      height: auto;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      align-items: start;
      justify-content: center;
    }
    .slide {
      position: relative;
      top: auto;
      display: none;
      width: 100%;
      height: auto;
      object-fit: contain;
    }
    .carousel video {
      width: auto;
      height: 100%;
    }
    a svg {
      font-size: 16px;
    }
    .carousel img {
      width: 100%;
      height: 100%;
      max-width: none;
      /* object-fit: cover; */
    }
    .slide.active {
      display: block;
    }
    .logo {
      position: absolute;
      max-width: 100%;
      height: auto;
      transform-origin: top left;
    }

    .logo.active {
      display: block;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      position: absolute;
      width: 100%;
      top: 0%;
      height: 100%;
    }
    .controls button {
      background: rgba(0, 0, 0, 0);
      color: white;
      padding: 10px 20px;
      font-size: 18px;
    }
    .indicators {
      position: absolute;
      bottom: 2%;
      display: flex;
      gap: 0.8vh;
      justify-content: start;
      align-items: center;
      overflow-x: auto;
      overflow-y: hidden;
      max-width: 88vw;
      height: 8vh;
      padding-left: 2vh;
    }
    .indicator {
      height: auto;
      max-height: 6vh;
      border: 1vh solid #555555;
      box-sizing: border-box;
      cursor: pointer;
      transition:
        border 0.5s ease,
        transform 0.5s ease;
    }

    .indicator.active {
      opacity: 1;
      transform: scale(1.1);
      border: 1vh solid #3a5ae9;
    }
    button svg {
      width: 2vh;
      height: 2vh;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <Header client:only />
  <div class="bg-gradient">
    <div class="carousel">
      {
        slides
          .slice(0, 5)
          .map((item, index) => (
            <img
              src={`/image/image_1/${item.featured_image}`}
              loading="lazy"
              class={`slide ${index === 0 ? "active" : ""}`}
              data-index={index}
              alt="Slide Image"
            />
          ))
      }

      <div class="controls">
        <button id="prevSlide">
          <svg
            width="18"
            height="19"
            viewBox="0 0 18 19"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M14.2466 1.05026C14.1152 0.981861 13.9721 0.94766 13.829 0.94766C13.649 0.94766 13.4708 1.00166 13.3169 1.10786L1.6169 9.20786C1.3739 9.37616 1.229 9.65246 1.229 9.94766C1.229 10.2429 1.3739 10.5192 1.6169 10.6875L13.3169 18.7875C13.5914 18.9774 13.9505 18.9999 14.2466 18.8451C14.5436 18.6894 14.729 18.3825 14.729 18.0477L14.729 1.84766C14.729 1.51286 14.5436 1.20596 14.2466 1.05026Z"
              fill="white"></path>
          </svg>
        </button>
        <button id="nextSlide">
          <svg
            width="18"
            height="18"
            viewBox="0 0 18 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M3.05393 17.897C3.18533 17.9654 3.32843 17.9996 3.47153 17.9996C3.65153 17.9996 3.82973 17.9456 3.98363 17.8394L15.6836 9.73941C15.9266 9.57111 16.0715 9.29481 16.0715 8.99961C16.0715 8.70441 15.9266 8.42811 15.6836 8.25981L3.98363 0.159806C3.70913 -0.0300944 3.35003 -0.0525944 3.05393 0.102206C2.75693 0.257906 2.57153 0.564806 2.57153 0.899606L2.57153 17.0996C2.57153 17.4344 2.75693 17.7413 3.05393 17.897Z"
              fill="white"></path>
          </svg>
        </button>
      </div>

      <div class="indicators">
        {
          slides
            .slice(0, 5)
            .map((item, index) => (
              <img
                src={`/image/image_1/${item.featured_image}`}
                class={`indicator ${index === 0 ? "active" : ""}`}
                data-index={index}
                alt="Indicator"
              />
            ))
        }
      </div>
    </div>
  </div>
  <Footer />

  <script>
    let currentSlide = 0;
    const allSlides = Array.from(document.querySelectorAll(".slide")).slice(
      0,
      5
    );
    const indicators = Array.from(
      document.querySelectorAll(".indicator")
    ).slice(0, 5);
    const videos = document.querySelectorAll("video");
    const totalSlides = allSlides.length;

    function showSlide(index) {
      videos.forEach((video) => {
        video.pause();
        video.currentTime = 0;
      });

      allSlides.forEach((slide, i) => {
        slide.classList.toggle("active", i === index);
      });

      indicators.forEach((el, i) => {
        el.classList.toggle("active", i === index);
      });

      const Description = document.querySelector(".Description");
      if (Description) {
        if (index === 0) {
          Description.classList.remove("hidden");
        } else {
          Description.classList.add("hidden");
        }
      }

      const currentSlideElement = allSlides[index];
      const video = currentSlideElement.querySelector("video");
      if (video) {
        video.play();
      }

      currentSlide = index;
    }

    document.getElementById("prevSlide").onclick = () => {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      showSlide(currentSlide);
    };

    document.getElementById("nextSlide").onclick = () => {
      currentSlide = (currentSlide + 1) % totalSlides;
      showSlide(currentSlide);
    };

    indicators.forEach((block, i) => {
      block.addEventListener("click", function () {
        showSlide(i);
      });
    });
  </script>
</body>
